!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CoCreateCursors=t():e.CoCreateCursors=t()}(this,(function(){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var o=document.querySelectorAll("input,textarea,[contenteditable]"),n=["boxSizing","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","marginTop","marginRight","marginBottom","marginLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","textRendering","webkitWritingMode","textTransform","textIndent","overflowWrap"];class i{static print(e,t){(t=t||!1)&&console.log(e)}static generateUUID(e=null){var t=(new Date).getTime(),r=performance&&performance.now&&1e3*performance.now()||0,o="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var o=16*Math.random();if(t>0){o=(t+o)%16|0;t=Math.floor(t/16)}else{o=(r+o)%16|0;r=Math.floor(r/16)}return("x"==e?o:7&o|8).toString(16)}));return null!=e&&(o=o.substr(0,e)),o}}var a,l,d,s,c=function(e,t,r){e.getAttribute("name");if(""==(e.getAttribute("data-document_id")||""))return!1;var o=e.dataset.mirror_id;a=document.getElementById(o);e.className.indexOf("floating-label");a||((a=document.createElement("div")).id=o,a.className="mirror_color mirror_scroll mirror-width-scroll",e.insertAdjacentElement("afterend",a));var i=e.offsetWidth-e.scrollWidth;d=a.style,l=getComputedStyle(e),s=getComputedStyle(e.parentElement);parseInt(l.marginTop),parseInt(l.marginLeft);"INPUT"!==e.nodeName?(d.wordWrap="break-word",d.whiteSpace="pre-wrap"):d.whiteSpace="pre",d.position="absolute";var c=e.getBoundingClientRect();document.documentElement.scrollTop;d.top=s.top,d.left=s.left,d.width=c.width-(parseInt(l.borderLeftWidth)+parseInt(l.borderRightWidth))+"px",d.height=c.height-(parseInt(l.borderTopWidth)+parseInt(l.borderBottomWidth))+"px",d.visibility="visible",n.forEach((function(e){d[e]=l[e]})),d.overflowX="auto",d.overflowY="hidden",d.paddingRight=parseInt(d.paddingRight)+i-parseInt(l.borderRightWidth)+"px";let u=a.querySelectorAll(".cursor-container"),m=a.querySelectorAll(".selectors_by_users"),f=-1==["TEXTAREA","INPUT"].indexOf(e.nodeName)?e.innerHTML:e.value;a.textContent=f.substring(0,t),"INPUT"===e.nodeName&&(a.textContent=a.textContent.replace(/\s/g,"Â "));var p=document.createElement("span");p.id=e.nodeName+"span_selections";let g=f.substring(t,r)||"";p.textContent=g,a.appendChild(p),u&&u.forEach((function(e,t,r){a.appendChild(e)})),m&&m.forEach((function(e,t,r){a.appendChild(e)}));let h=f.substring(r)||"";var y=document.createElement("span");a.appendChild(y),y.textContent=h;c=e.getBoundingClientRect();return{start:{top:p.offsetTop,left:p.offsetLeft},end:{top:y.offsetTop,left:y.offsetLeft}}};function u(e,t){if(window.getComputedStyle)var r=document.defaultView.getComputedStyle(e,null).getPropertyValue(t);return r}function m(e){i.print(["draw Cursor ",e],!1);let t=e.element;if(!t.dataset.cursors||t.dataset.mirror_id){let n=e.startPosition,a=e.endPositon,l=e.clientId,d=t.getAttribute("data-document_id")||"";if(""!=d){i.print("action document_id "+d,!1),void 0!==t.dataset.mirror_id&&""!=t.dataset.mirror_id||(t.dataset.mirror_id=i.generateUUID(30));let s=c(t,n,a);if(!s)return!1;t.getAttribute("name");let m=t.dataset.mirror_id,f=document.getElementById(m),p=!1,g=!1,h="_"+m,y=!(void 0===e||!e.hasOwnProperty("user"))&&e.user,_=!(void 0===e||!e.hasOwnProperty("user_id"))&&y.user_id;if(l){if(cursores_other_elements=document.querySelectorAll("#socket_"+l+h),cursores_other_elements.forEach((function(e,t,r){e.parentElement.getAttribute("id")!=m&&(i.print("remove old cursor others elements",!1),e.remove())})),p=f.querySelector(".cursor-container#socket_"+l+h),!p&&e.hasOwnProperty("user")){if(y){i.print("Create Cursor",!1);let e='<div style="color:blue;" class="cursor-container"                                                   id="socket_'+l+h+'"                                                   ><div class="cursor"                                                   style="background-color:'+y.color+'"></div>                                                  <div class="cursor-flag" data-collection="users"                                                   name="name"                                                   data-user_name="'+y.name+'"                                                   data-user_color="'+y.color+'"                                                   data-socket_id="'+l+'"                                                   data-id_mirror="'+m+'"                                                   data-document_id="'+_+'"                                                   style="background-color:'+y.color+'"                                                   flag>'+y.name+"</div></div>";f.innerHTML=e+f.innerHTML}_&&CoCreate.readDocument({collection:"users",document_id:_})}p=f.querySelector(".cursor-container#socket_"+l+h)}if(p){i.print(["Update Cursor",p,s],!1);let e=u(t,"font-size");e=parseFloat(e.substring(0,e.length-2));let d=112.5*e/100,c=p.querySelector(".cursor");if(p.dataset.start=n,p.dataset.end=a,p.dataset.socket_id=l,p.style.top=s.end.top+"px",p.style.width="2px",c.style.height=d+"px",p.style.left=s.end.left+"px",g=document.getElementById("sel-"+l+h),n!=a&&y){g=document.getElementById("sel-"+l+h),g&&g.remove();var r=t.offsetWidth-t.scrollWidth,o=parseInt(getComputedStyle(t).paddingRight);g=document.createElement("span"),g.id="sel-"+l+h,g.className="selectors_by_users";let e=getComputedStyle(f);g.style.position="absolute",g.style.top=e.paddingTop,g.style.left=e.paddingLeft,g.style["padding-right"]=r+o+"px",f.insertBefore(g,f.firstChild);let i=document.createElement("span");i.id="selection-"+l+h,i.style.backgroundColor=y.color;let d=-1==["TEXTAREA","INPUT"].indexOf(t.nodeName)?t.innerHTML:t.value;g.textContent=d.substring(0,n);let s=d.substring(n,a)||"";i.textContent=s,g.appendChild(i)}else g&&g.remove()}}}}function f(e){let t=e.getAttribute("data-document_id")||"";""!=t&&(name=e.getAttribute("name"),id_mirror=e.dataset.mirror_id,mi_mirror=document.getElementById(id_mirror),i.print(["refresh_mirror ",mi_mirror],!1),selector_element=e.nodeName+"[name='"+name+"'][data-document_id='"+t+"']",i.print(["selector -> "+selector_element],!1),mi_mirror&&(l=getComputedStyle(e),(d=mi_mirror.style).width=e.offsetWidth-(parseInt(l.borderLeftWidth)+parseInt(l.borderRightWidth))+"px",d.height=e.offsetHeight-(parseInt(l.borderTopWidth)+parseInt(l.borderBottomWidth))+"px",cursor_container=mi_mirror.querySelectorAll(".cursor-container"),cursor_container.forEach((function(t,r,o){let n=t.querySelector(".cursor-flag").dataset,i=t.dataset;m({element:e,startPosition:i.start,endPositon:i.end,clientId:i.socket_id,user:{color:n.user_color,name:i.user_name}})}))))}function p(e){let t=void(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),r=t.length;--r>=0&&t.item(r)!==this;);return r>-1})),r=e.hasAttribute("data-realtime")?e.getAttribute("data-realtime"):"true";if("true"==r||t&&"true"==t.getAttribute("data-realtime")){if("false"==r)return!1;i.print(["Init Events ",e],!1),e.addEventListener("scroll",(function(){i.print(["Move Scroll ",e],!0);e.getAttribute("name"),e.getAttribute("data-document_id");let t=e.dataset.mirror_id,r=document.getElementById(t);r&&r.scrollTo(e.scrollLeft,e.scrollTop)}),!1),new ResizeObserver((function(){o.forEach((function(t,r,o){t.getAttribute("name");let n=e.dataset.mirror_id;i.print(["Resize id_mirror -> "+n],!1);let a=document.getElementById(n);a&&(a.style.width=t.offsetWidth+"px",a.style.height=t.offsetHeight+"px",document.activeElement===e&&c(e,e.selectionStart,e.selectionEnd),f(e))}))})).observe(e),e.addEventListener("mousemove",(function(t){e.getAttribute("name"),e.getAttribute("data-document_id");let r=e.dataset.mirror_id,o=document.getElementById(r);o&&o.scrollTo(e.scrollLeft,e.scrollTop)})),e.addEventListener("focusout",(function(t){e.getAttribute("name"),e.getAttribute("data-document_id");let r=e.dataset.mirror_id,o=document.getElementById(r);o&&o.scrollTo(e.scrollLeft,e.scrollTop)})),e.addEventListener("keydown",(function(t){e.getAttribute("name");let r=e.dataset.mirror_id,o=document.getElementById(r);o&&(o.scrollTo(e.scrollLeft,e.scrollTop),f(e))})),e.addEventListener("keyup",(function(t){e.getAttribute("name");let r=e.dataset.mirror_id,o=document.getElementById(r);o&&o.scrollTo(e.scrollLeft,e.scrollTop)}))}}CoCreateSocket.listen("readDocument",(function(e){cursor=document.querySelector('.cursor-flag[data-document_id="'+e.document_id+'"]'),cursor&&(cursor.innerHTML=e.result[cursor.getAttribute("name")])})),Element.prototype.remove=function(){this.parentElement&&this.parentElement.removeChild(this)};function g(e){let t=e||window;t.querySelectorAll&&t.querySelectorAll("[data-realtime=true]").forEach(e=>{p(e)})}window.addEventListener("resize",(function(e){document.querySelectorAll("[data-mirror_id]").forEach((function(e,t,r){f(e)}))}),!0),document.addEventListener("scroll",(function(e){document.querySelectorAll("[data-mirror_id]").forEach((function(e,t,r){f(e)}))}),!0),function(e){e.forEach((function(e,t,r){p(e)}))}(o),CoCreateObserver.add({name:"CoCreateCursor",observe:["subtree","childList"],include:"[data-collection][data-document_id][name][data-realtime=true]",task:function(e){g(e.target)}});const h={getStyle:u,getDocument:function(e,t){CoCreate.readDocument({collection:e,document_id:t})},draw_cursor:m,refresh_mirror:f,recalculate_local_cursors:function(e,t){i.print("count "+t,!1);let r=e.hasAttribute("contenteditable")?parseInt(e.getAttribute("selection_start")):e.selectionStart,o=(e.getAttribute("name"),e.getAttribute("data-document_id"),e.getAttribute("data-collection"),e.dataset.mirror_id),n=document.getElementById(o),a=n?n.querySelectorAll(".cursor-container"):null;if(a){let o=[];a.forEach((function(n,a,l){let d=parseInt(n.getAttribute("data-start")),s=n.getAttribute("data-user_name");if(i.print(["my_start local",r,"start cursor "+s+" = ",d],!1),d>r&&-1==o.indexOf(s)){i.print("Es mayor",!1);let r=parseInt(n.getAttribute("data-end")),a=d+t,l=r+t;i.print(["pos_start",a,"pos_end",l],!1);let c=n.querySelector(".cursor-flag").dataset,u=c.socket_id,f={element:e,startPosition:a,endPositon:l,clientId:u,user:{color:c.user_color,name:c.user_name}};i.print(["sent Draw Cursor ",f],!1),m(f),o.push(s)}}))}},initCursorEl:p,initCursorElements:g};t.default=h}]).default}));