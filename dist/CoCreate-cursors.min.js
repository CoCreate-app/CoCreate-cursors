!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CoCreate=e():(t.CoCreate=t.CoCreate||{},t.CoCreate.cursors=e())}(this,(function(){return(()=>{var t={240:function(t,e){var r;"undefined"!=typeof self&&self,void 0===(r=function(){return function(t){function e(){let e={};return t&&t.config&&(e=t.config),{apiKey:e.apiKey,organization_id:e.organization_Id}}function r(e){let r={};return t&&t.config&&(r=t.config),{apiKey:e.apiKey||r.apiKey,organization_id:e.organization_id||r.organization_Id}}function n(e,r){let n={};t&&t.config&&(n=t.config);let o=e||n.organization_Id,a=r||"";return a?`${o}/${a}`:o}return{getCommonParams:e,getCommonParamsExtend:r,generateSocketClient:n}}(window)}.apply(e,[]))||(t.exports=r)},864:function(t,e,r){var n,o;"undefined"!=typeof self&&self,n=[r(240),r(776)],void 0===(o=function(t,e){return function(t,e,r,n,o){class a{constructor(t="crud"){this.prefix=t||"crud",this.sockets=new Map,this.listeners=new Map,this.messageQueue=new Map,this.saveFileName="",this.globalScope=""}setGlobalScope(t){this.globalScope=`${this.prefix}/${t}`}getGlobalScope(){return this.globalScope}create(t){const{namespace:o,room:a}=t,i=this.getKey(o,a);let s,c=this;if(o&&this.setGlobalScope(o),this.sockets.get(i))return void(s=this.sockets.get(i));let l=e.location.protocol;"about:"===e.location.protocol&&(l=e.parent.location.protocol,t.host||(t.host=e.parent.location.host));let d="http:"===l?"ws":"wss";const u=t.port?t.port:8088;let f=`${d}://${e.location.host}:${u}/${i}`;t.host&&(f=t.host.includes("://")?`${t.host}/${i}`:t.host.includes(":")?`${d}://${t.host}/${i}`:`${d}://${t.host}:${u}/${i}`);try{let t=null;e.localStorage&&(t=e.localStorage.getItem("token")),s=new r(f,t),s.cocreate_connected=!1,this.sockets.set(i,s)}catch(t){return}s.onopen=function(t){s.cocreate_connected||(s.cocreate_connected=!0),(c.messageQueue.get(i)||[]).forEach((t=>s.send(JSON.stringify(t)))),c.messageQueue.set(i,[])},s.onclose=function(e){switch(e.code){case 1e3:break;default:c.destroy(s,i),c.reconnect(s,t)}},s.onerror=function(e){c.destroy(s,i),c.reconnect(s,t)},s.onmessage=function(t){try{if(e.Blob&&t.data instanceof n)return void c.saveFile(t.data);let r=JSON.parse(t.data);if(r.data&&(r.data.uid&&c.__fireEvent(r.data.uid,r.data),r.data.event))return void c.__fireEvent(r.data.event,r.data);r.action;const o=c.listeners.get(r.action);if(!o)return;o.forEach((t=>{t(r.data,i)}))}catch(t){}}}__fireEvent(t,r){if(e.CustomEvent){var n=new e.CustomEvent(t,{detail:r});e.document.dispatchEvent(n)}else process.emit(t,r)}send(t,e,r){const n=o.generate(),a={action:t,data:{...e,uid:n}},i=this.getKeyByRoom(r),s=this.getByRoom(r);return s&&s.cocreate_connected?s.send(JSON.stringify(a)):this.messageQueue.get(i)?this.messageQueue.get(i).push(a):this.messageQueue.set(i,[a]),n}sendFile(t,e){const r=this.getByRoom(e);r&&r.send(t)}listen(t,e){this.listeners.get(t)?this.listeners.get(t).push(e):this.listeners.set(t,[e])}reconnect(t,e){let r=this;setTimeout((function(){r.create(e)}),1e3)}destroy(t,e){t&&(t.onerror=t.onopen=t.onclose=null,t.close(),t=null),this.sockets.get(e)&&this.sockets.delete(e)}destroyByKey(t){let e=this.sockets.get(t);e&&this.destroy(e,t)}getKey(t,e){let r=`${this.prefix}`;return t&&""!=t&&(r+=e&&""!=e?`/${t}/${e}`:`/${t}`),r}getByRoom(t){let e=this.getKeyByRoom(t);return this.sockets.get(e)}getKeyByRoom(t){let e=this.globalScope;return t&&(e=`${this.prefix}/${t}`),e}saveFile(t){if(e.document){const n=this.saveFileName||"downloadFile";var r=e.document.createElement("a");e.document.body.appendChild(r),r.style="display: none";let o=window.URL.createObjectURL(t);r.href=o,r.download=n,r.click(),e.URL.revokeObjectURL(o),this.saveFileName=""}}listenAsync(t){return new Promise(((r,n)=>{let o=setTimeout((()=>{clearTimeout(o),r(null)}),5e3);e.document?e.document.addEventListener(t,(function(t){r(t.detail)}),{once:!0}):process.once(t,(t=>{r(t)}))}))}}return a}(0,window,WebSocket,Blob,e)}.apply(e,n))||(t.exports=o)},776:function(t,e){var r;"undefined"!=typeof self&&self,void 0===(r=function(){return function(t){const e={attribute:"data-uuid",init:function(e){if(!t.document)return;const r=e||t.document;if(!r.querySelectorAll)return;let n=r.querySelectorAll(`[${this.attribute}]`);const o=this;n.forEach((t=>{const e=parseInt(t.getAttribute(o.attribute))||36,r=o.generate(e);"INPUT"===t.tagName||"TEXTAREA"===t.tagName?t.value=r:t.innerHTML=r}))},generate:function(e=36){let r=(new Date).getTime(),n=t.performance&&t.performance.now&&1e3*t.performance.now()||0,o="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";if(e<=o.length)o=o.substr(0,e);else{let t=e-o.length,r="-xxxyyxxx",n=Math.floor(t/r.length);for(let t=0;t<n;t++)o+=r;n=t-n*r.length,o+=r.substr(0,n)}return o.replace(/[xy]/g,(function(t){var e=16*Math.random();return r>0?(e=(r+e)%16|0,r=Math.floor(r/16)):(e=(n+e)%16|0,n=Math.floor(n/16)),("x"==t?e:7&e|8).toString(16)}))}};return e.init(),e}(window)}.apply(e,[]))||(t.exports=r)},15:function(t,e,r){var n,o;"undefined"!=typeof self&&self,n=[r(240),r(965)],void 0===(o=function(t,e){return function(t,e,r){return{socket:null,setSocket:function(t){this.socket=t},readDocumentList:async function(t){if(!t)return!1;let r=e.getCommonParams();if(!t.collection)return!1;r={...r,...t},e.generateSocketClient(t.namespace,t.room);const n=this.socket.send("readDocumentList",r);try{return await this.socket.listenAsync(n)}catch(t){return null}},createDocument:async function(r){if(null===r)return!1;let n=e.getCommonParamsExtend(r),o={...r,...n},a=r.data||{};a.organization_id||(a.organization_id=t.config.organization_Id),r.data&&(a={...a,...r.data}),o.data=a;const i=e.generateSocketClient(r.namespace,r.room);let s=this.socket.send("createDocument",o,i);try{return await this.socket.listenAsync(s)}catch(t){return null}},updateDocument:async function(t){if(!t)return!1;if(t.document_id&&!r.checkDocumentId(t.document_id))return!1;let n=e.getCommonParamsExtend(t),o={...t,...n};if("object"==typeof t.data&&(o.set=t.data),Array.isArray(t.delete_fields)&&(o.unset=t.delete_fields),!o.set&&!o.unset)return!1;!1===t.broadcast&&(o.broadcast=!1),void 0===t.broadcast_sender&&(o.broadcast_sender=!0);const a=e.generateSocketClient(t.namespace,t.room);let i=this.socket.send("updateDocument",o,a);try{return await this.socket.listenAsync(i)}catch(t){return null}},readDocument:async function(t){if(null===t)return null;if(!t||!r.checkDocumentId(t.document_id))return null;let n=e.getCommonParamsExtend(t),o={...t,...n},a=this.socket.send("readDocument",o);try{return e.generateSocketClient(t.namespace,t.room),await this.socket.listenAsync(a)}catch(t){return null}},deleteDocument:async function(t){if(!t||!r.checkDocumentId(t.document_id))return null;let n=e.getCommonParamsExtend(t),o={...t,...n};const a=e.generateSocketClient(t.namespace,t.room);let i=this.socket.send("deleteDocument",o,a);try{return await this.socket.listenAsync(i)}catch(t){return null}},exportCollection:function(t){if(null===t)return;let r=e.getCommonParamsExtend(t);r.collection=t.collection,r.export_type=t.export_type,r.metadata=t.metadata,this.socket.send("exportDB",r)},importCollection:function(r){const{file:n}=r;if(null===r||!(n instanceof t.File))return;const o=n.name.split(".").pop();if(!["json","csv"].some((t=>t===o)))return;let a=e.getCommonParamsExtend(r);a.collection=r.collection,a.import_type=o,this.socket.send("importDB",a),this.socket.sendFile(n)},listen:function(t,e){this.socket.listen(t,e)},listenAsync:function(t){return this.socket.listenAsync(t)},createSocket:function(t,e){e?(this.socket.create({namespace:e,room:null,host:t}),this.socket.setGlobalScope(e)):this.socket.create({namespace:null,room:null,host:t})},read:async function(t,e){const{collection:n,document_id:o,name:a,namespace:i,room:s,is_read:c}=r.getAttr(t);return!1!==e&&(e=!0),r.isJsonString(n)||r.isJsonString(o)?null:o&&n&&c?await this.readDocument({namespace:i,room:s,collection:n,document_id:o,name:a,is_flat:e}):null},save:async function(t){if(t)for(let e=0;e<t.length;e++)await this.saveElement(t[e])},saveElement:async function({element:e,value:n,is_flat:o}){if(!e||null===n)return;const{collection:a,document_id:i,name:s,namespace:c,room:l,broadcast:d,broadcast_sender:u,is_save:f}=r.getAttr(e);if(f&&a&&s)if(r.isCRDT(e)&&t.CoCreate.crdt)t.CoCreate.crdt.replaceText({collection:a,name:s,document_id:i,name:s,value:n});else{let t=await this.updateDocument({namespace:c,room:l,collection:a,document_id:i,upsert:!0,broadcast:d,broadcast_sender:u,is_flat:!1!==o,data:{[s]:n}});t.document_id&&i!==t.document_id&&await this.setDocumentId({element:e,docuement_id:t.document_id})}},setDocumentId:async function({element:t,form:e,document_id:r}){!e&&t&&(e=t.closest("form")),e?await CoCreate.form.setDocumentId(e):t&&t.setAttribute("data-document_id",r)},...r}}(window,t,e)}.apply(e,n))||(t.exports=o)},611:function(t,e,r){var n,o;"undefined"!=typeof self&&self,n=[r(864),r(15)],void 0===(o=function(t,e){return function(t,e,r){if(t){let t=window.CoCreateCrudSocket;t||(t=new e("ws"),window.CoCreateCrudSocket=t),r.setSocket(t),r.createSocket(window.config.host?window.config.host:window.location.hostname,window.config.organization_Id)}return r}(!0,t,e)}.apply(e,n))||(t.exports=o)},965:function(t,e){var r;"undefined"!=typeof self&&self,void 0===(r=function(){return function(){function t(e,r){e=e||{};for(let n of Object.keys(r))r[n]instanceof Object&&Object.assign(r[n],t(e[n],r[n]));return Object.assign(e||{},r),e}function e(t,e){if(!e)return t;let r=e.split("."),n=t;for(var o=r.length-1;o>=0;o--)n={[r[o]]:n};return n}function r(t,e){try{let r=/([\w\W]+)\[(\d+)\]/gm.exec(t);if(r&&3==r.length){let n=r[1],o=parseInt(r[2]);e[n]&&Array.isArray(e[n])||(e[n]=[]),e[n][o]=e[t],delete e[t],t=n}}catch{}return t}function n(t,e){try{if(!t||!e)return null;if(e[t])return e[t];let n=t.split("."),o={...e};for(var r=0;r<n.length&&o;r++)o=o[n[r]];return o}catch{return null}}function o(t){return!!t&&t.constructor===Object}function a(t){return!!t&&t.constructor===Array}function i(n){let o=Object.keys(n),a={};return o.forEach((o=>{if((o=r(o,n)).split(".").length>1){let r=e(n[o],o);delete n[o],a=t(a,r)}else a[o]=n[o]})),a}function s(t){let e=Object.keys(t),r={};return e.forEach((e=>{let n=t[e];if(o(t[e])){let n=s(t[e]);Object.keys(n).forEach((t=>{let o=n[t];r[t=e+"."+t]=o}))}else a(n)?n.forEach(((t,n)=>{r[`${e}[${n}]`]=t})):r[e]=t[e]})),r}function c(t){if(!t)return;let e=t.getAttribute("data-collection"),r=t.getAttribute("data-document_id"),n=t.getAttribute("name"),o=t.getAttribute("data-room");return{collection:e,document_id:r,name:n,is_realtime:h(t),is_save:d(t),is_read:l(t),is_update:u(t),is_listen:p(t),broadcast:f(t),broadcast_sender:m(t),room:o}}const l=t=>g(t,"data-read_value"),d=t=>g(t,"data-save_value"),u=t=>g(t,"data-update_value"),f=t=>g(t,"data-broadcast"),m=t=>g(t,"data-broadcast_sender"),p=t=>g(t,"data-listen"),h=t=>!!t&&"false"!=t.getAttribute("data-realtime");function g(t,e){return!!t&&"false"!==t.getAttribute(e)}function b(t){return!!t&&!/{{\s*([\w\W]+)\s*}}/g.test(t)}function y(t){try{let e=JSON.parse(t);return"object"==typeof e&&null!=e}catch(t){return!1}}function _(t){const{collection:e,document_id:r,name:n}=c(t);return!(y(e)||y(n)||!("INPUT"===t.tagName&&["text","email","tel","url"].includes(t.type)||"TEXTAREA"===t.tagName)||!n||!h(t)||"true"===t.getAttribute("data-unique")||"password"===t.type||!l(t))}function v(t){try{return!!t&&"null"!==t.toLowerCase()}catch(t){return!1}}function y(t){try{let e=JSON.parse(t);return"object"==typeof e&&null!=e}catch(t){return!1}}return{decodeObject:i,encodeObject:s,getAttr:c,isRealtimeAttr:h,isReadAttr:l,isSaveAttr:d,isUpdateAttr:u,isFlatAttr:t=>g(t,"data-flat"),checkAttrValue:b,isCRDT:_,checkDocumentId:v,getValueByPath:n,isJsonString:y}}()}.apply(e,[]))||(t.exports=r)},366:(t,e,r)=>{"use strict";function n(t){this.callbackMap=new Map,this.callbackMap.set("ALL",{attributes:[],addedNodes:[],removedNodes:[],characterData:[],childList:[]});let[e,r]=this.runCallbackGen("attributes");this.runCallbackAtt=e,this.runCallbackAttAll=r,[e,r]=this.runCallbackGen("characterData"),this.runCallbackChar=e,this.runCallbackCharAll=r,this.runCallbackAdd=this.runCallbackExGen("addedNodes","addedNodes"),this.runCallbackRemove=this.runCallbackExGen("removedNodes","removedNodes");new MutationObserver((t=>this._callback.call(this,t))).observe(t,{subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0})}r.r(e),r.d(e,{default:()=>a}),window.counter=0;const o=["addedNodes","removedNodes","attributes","characterData","childList"];n.prototype.init=function({observe:t=["addedNodes","attributes"],attributeFilter:e,callback:r}){if(!t||!t.every((t=>o.includes(t))))throw"please enter a valid observe";if(this.observe=t,this.callback=r,e&&e.length)for(let t of e)this._register(t.toLowerCase());else this._register("ALL")},n.prototype._register=function(t){for(let e of this.observe)"childList"!==e?this.callbackMap.has(t)?this.callbackMap.get(t)[e]?this.callbackMap.get(t)[e].push(this.callback):this.callbackMap.get(t)[e]=[this.callback]:this.callbackMap.set(t,{[e]:[this.callback]}):this.callbackMap.get("ALL").childList&&this.callbackMap.get("ALL").childList.push(this.callback)},n.prototype.uninit=function(t){for(let[e,r]of this.callbackMap.entries())r.attributes&&(r.attributes=r.attributes.filter((e=>e!==t))),r.characterData&&(r.characterData=r.characterData.filter((e=>e!==t))),r.addedNodes&&(r.addedNodes=r.addedNodes.filter((e=>e!==t))),r.removedNodes&&(r.removedNodes=r.removedNodes.filter((e=>e!==t))),r.childList&&(r.childList=r.childList.filter((e=>e!==t))),this.callbackMap.set(e,{attributes:r.attributes,characterData:r.characterData,addedNodes:r.addedNodes,removedNodes:r.removedNodes,childList:r.childList})},n.prototype._callback=function(t){for(let e of t)switch(window.counter++,e.type){case"attributes":this._attributeCallback(e);break;case"characterData":this._characterDataCallback(e);break;case"childList":this._childListCallback(e)}},n.prototype.runCallbackGen=function(t){return[function(e,r){let n=this.callbackMap.get(r);if(n&&n[t])for(let r of n[t])r(e)},function(e){for(let r of this.callbackMap.get("ALL")[t])r(e)}]},n.prototype._attributeCallback=function(t){if(!t.target.hasAttributes(t.attributeName))return;t.target.getAttribute(t.attributeName)!==t.oldValue&&(this.runCallbackAtt(t,t.attributeName),this.runCallbackAttAll(t))},n.prototype._characterDataCallback=function(t){if(t.target.data===t.oldValue)return;this.runCallbackCharAll(t);let e=t.target.parentElement;for(let r of e.attributes)this.runCallbackChar(t,r.name)},n.prototype.runCallbackExGen=function(t,e){return function r(n){for(let o of n[e]){if(o.tagName)for(let e of o.attributes){let r=this.callbackMap.get(e.name);if(r&&r[t])for(let e of r[t])e({type:n.type,target:o,[t]:!0})}o.children&&r.call(this,{[e]:o.children})}for(let r of this.callbackMap.get("ALL")[t])for(let o of n[e])o.tagName&&r({type:n.type,target:o,[t]:!0})}},n.prototype._childList=function(t){this.callbackMap.get("ALL").childList.forEach((e=>{e(t)}))},n.prototype._childListCallback=function(t){this._childList(t),this.runCallbackAdd(t),this.runCallbackRemove(t)},n.prototype.setInitialized=function(t,e){t["co_initialized_"+(e=e||"")]=!0},n.prototype.getInitialized=function(t,e){return!!t["co_initialized_"+(e=e||"")]};const a=new n(document.body)},212:function(t,e){var r;"undefined"!=typeof self&&self,void 0===(r=function(){return function(t){const e={attribute:"data-uuid",init:function(e){if(!t.document)return;const r=e||t.document;if(!r.querySelectorAll)return;let n=r.querySelectorAll(`[${this.attribute}]`);const o=this;n.forEach((t=>{const e=parseInt(t.getAttribute(o.attribute))||36,r=o.generate(e);"INPUT"===t.tagName||"TEXTAREA"===t.tagName?t.value=r:t.innerHTML=r}))},generate:function(e=36){let r=(new Date).getTime(),n=t.performance&&t.performance.now&&1e3*t.performance.now()||0,o="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";if(e<=o.length)o=o.substr(0,e);else{let t=e-o.length,r="-xxxyyxxx",n=Math.floor(t/r.length);for(let t=0;t<n;t++)o+=r;n=t-n*r.length,o+=r.substr(0,n)}return o.replace(/[xy]/g,(function(t){var e=16*Math.random();return r>0?(e=(r+e)%16|0,r=Math.floor(r/16)):(e=(n+e)%16|0,n=Math.floor(n/16)),("x"==t?e:7&e|8).toString(16)}))}};return e.init(),e}(window)}.apply(e,[]))||(t.exports=r)},605:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>s});var n=r(483),o=r.n(n);const a=r.p+"4bae7f440ab1de156d0d0d0d0a566858.css";var i={injectType:"linkTag",insert:"head"};o()(a,i);const s={}},483:(t,e,r)=>{"use strict";var n,o=(n={},function(t){if(void 0===n[t]){var e=document.querySelector(t);if(window.HTMLIFrameElement&&e instanceof window.HTMLIFrameElement)try{e=e.contentDocument.head}catch(t){e=null}n[t]=e}return n[t]});t.exports=function(t,e){if((e=e||{}).attributes="object"==typeof e.attributes?e.attributes:{},void 0===e.attributes.nonce){var n=r.nc;n&&(e.attributes.nonce=n)}var a=document.createElement("link");if(a.rel="stylesheet",a.href=t,Object.keys(e.attributes).forEach((function(t){a.setAttribute(t,e.attributes[t])})),"function"==typeof e.insert)e.insert(a);else{var i=o(e.insert||"head");if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(a)}return function(t){"string"==typeof t?a.href=t:a.parentNode.removeChild(a)}}}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var a=e[n]={exports:{}};return t[n].call(a.exports,a,a.exports,r),a.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;r.g.importScripts&&(t=r.g.location+"");var e=r.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");n.length&&(t=n[n.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=t})();var n={};return(()=>{"use strict";var t=n;t.default=void 0;var e=i(r(366)),o=i(r(611)),a=i(r(212));function i(t){return t&&t.__esModule?t:{default:t}}r(605);var s=document.querySelectorAll("input,textarea,[contenteditable]"),c=!1,l=["boxSizing","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","marginTop","marginRight","marginBottom","marginLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","textRendering","webkitWritingMode","textTransform","textIndent","overflowWrap"];class d{static print(t,e){e=e||!1}}var u,f,m,p=function(t,e,r){t.getAttribute("name");if(""==(t.getAttribute("data-document_id")||""))return!1;var n=t.dataset.mirror_id;u=document.getElementById(n);t.className.indexOf("floating-label");u||((u=document.createElement("div")).id=n,u.className="mirror_color mirror_scroll mirror-width-scroll",t.insertAdjacentElement("afterend",u));t.offsetWidth,t.scrollWidth;m=u.style,f=getComputedStyle(t),getComputedStyle(t.parentElement);parseInt(f.marginTop),parseInt(f.marginLeft);"INPUT"!==t.nodeName?(m.wordWrap="break-word",m.whiteSpace="pre-wrap"):m.whiteSpace="pre",m.position="absolute";var o=t.getBoundingClientRect();document.documentElement.scrollTop;m.top=t.offsetTop+"px",m.left=t.offsetLeft+"px",m.width=o.width+"px",m.height=o.height+"px",m.visibility="visible",l.forEach((function(t){-1===["left","top"].indexOf(t.toLowerCase())&&(m[t]=f[t])})),m.overflowX="auto",m.overflowY="hidden",m.margin="0px",m.border=f.border,m.borderColor="transparent";let a=u.querySelectorAll(".cursor-container"),i=u.querySelectorAll(".selectors_by_users"),s=-1==["TEXTAREA","INPUT"].indexOf(t.nodeName)?t.innerHTML:t.value;u.textContent=s.substring(0,e),"INPUT"===t.nodeName&&(u.textContent=u.textContent.replace(/\s/g," "));var c=document.createElement("span");c.id=t.nodeName+"span_selections";let d=s.substring(e,r)||"";c.textContent=d,u.appendChild(c),a&&a.forEach((function(t,e,r){u.appendChild(t)})),i&&i.forEach((function(t,e,r){u.appendChild(t)}));let p=s.substring(r)||"";var h=document.createElement("span");u.appendChild(h),h.textContent=p;o=t.getBoundingClientRect();return{start:{top:c.offsetTop,left:c.offsetLeft},end:{top:h.offsetTop,left:h.offsetLeft}}};function h(t){d.print(["draw Cursor ",t],c);let e=t.element;if(!e.dataset.cursors||e.dataset.mirror_id){let i=t.startPosition,s=t.endPositon,l=t.clientId,u=e.getAttribute("data-document_id")||"";if(""!=u){d.print("action document_id "+u,c),void 0!==e.dataset.mirror_id&&""!=e.dataset.mirror_id||(e.dataset.mirror_id=a.default.generate(30));let f=p(e,i,s);if(!f)return!1;e.getAttribute("name");let m=e.dataset.mirror_id,h=document.getElementById(m),g=!1,b=!1,y="_"+m,_=!(void 0===t||!t.hasOwnProperty("user"))&&t.user,v=!(void 0===t||!t.hasOwnProperty("user_id"))&&_.user_id;if(l){if(document.querySelectorAll("#socket_"+l+y).forEach((function(t,e,r){t.parentElement.getAttribute("id")!=m&&(d.print("remove old cursor others elements",c),t.remove())})),g=h.querySelector(".cursor-container#socket_"+l+y),!g&&t.hasOwnProperty("user")){if(_){d.print("Create Cursor",c);let t='<div style="color:blue;" class="cursor-container"                                                   id="socket_'+l+y+'"                                                   ><div class="cursor"                                                   style="background-color:'+_.color+'"></div>                                                  <div class="cursor-flag" data-collection="users"                                                   name="name"                                                   data-user_name="'+_.name+'"                                                   data-user_color="'+_.color+'"                                                   data-socket_id="'+l+'"                                                   data-id_mirror="'+m+'"                                                   data-document_id="'+v+'"                                                   style="background-color:'+_.color+'"                                                   flag>'+_.name+"</div></div>";h.innerHTML=t+h.innerHTML}v&&o.default.readDocument({collection:"users",document_id:v})}g=h.querySelector(".cursor-container#socket_"+l+y)}if(g){d.print(["Update Cursor",g,f],c);let t=function(t,e){if(window.getComputedStyle)var r=document.defaultView.getComputedStyle(t,null).getPropertyValue(e);return r}(e,"font-size");t=parseFloat(t.substring(0,t.length-2));let o=112.5*t/100,a=g.querySelector(".cursor");if(g.dataset.start=i,g.dataset.end=s,g.dataset.socket_id=l,g.style.top=f.end.top+"px",g.style.width="2px",a.style.height=o+"px",g.style.left=f.end.left+"px",b=document.getElementById("sel-"+l+y),i!=s&&_){b=document.getElementById("sel-"+l+y),b&&b.remove();var r=e.offsetWidth-e.scrollWidth,n=parseInt(getComputedStyle(e).paddingRight);b=document.createElement("span"),b.id="sel-"+l+y,b.className="selectors_by_users";let t=getComputedStyle(h);b.style.position="absolute",b.style.top=t.paddingTop,b.style.left=t.paddingLeft,b.style["padding-right"]=r+n+"px",h.insertBefore(b,h.firstChild);let o=document.createElement("span");o.id="selection-"+l+y,o.style.backgroundColor=_.color;let a=-1==["TEXTAREA","INPUT"].indexOf(e.nodeName)?e.innerHTML:e.value;b.textContent=a.substring(0,i);let c=a.substring(i,s)||"";o.textContent=c,b.appendChild(o)}else b&&b.remove()}}}}function g(t){var e="";let r=t.getAttribute("data-document_id")||"";if(""!=r){if(name=t.getAttribute("name"),!t.dataset.mirror_id)return;e=t.dataset.mirror_id;var n=document.getElementById(e);d.print(["refresh_mirror ",n],c);var o=t.nodeName+"[name='"+name+"'][data-document_id='"+r+"']";if(d.print(["selector -> "+o],c),n)f=getComputedStyle(t),(m=n.style).width=t.offsetWidth-(parseInt(f.borderLeftWidth)+parseInt(f.borderRightWidth))+"px",m.height=t.offsetHeight-(parseInt(f.borderTopWidth)+parseInt(f.borderBottomWidth))+"px",n.querySelectorAll(".cursor-container").forEach((function(e,r,n){let o=e.querySelector(".cursor-flag").dataset,a=e.dataset;h({element:t,startPosition:a.start,endPositon:a.end,clientId:a.socket_id,user:{color:o.user_color,name:a.user_name}})}))}}function b(t){let e,r=t.hasAttribute("data-realtime")?t.getAttribute("data-realtime"):"true";if("true"==r||e&&"true"==e.getAttribute("data-realtime")){if("false"==r)return!1;d.print(["Init Events ",t],c),t.addEventListener("scroll",(function(){d.print(["Move Scroll ",t],!0);t.getAttribute("name"),t.getAttribute("data-document_id");let e=t.dataset.mirror_id,r=document.getElementById(e);r&&r.scrollTo(t.scrollLeft,t.scrollTop)}),!1),new ResizeObserver((function(){s.forEach((function(e,r,n){e.getAttribute("name");let o=t.dataset.mirror_id;d.print(["Resize id_mirror -> "+o],c);let a=document.getElementById(o);a&&(a.style.width=e.offsetWidth+"px",a.style.height=e.offsetHeight+"px",document.activeElement===t&&p(t,t.selectionStart,t.selectionEnd),g(t))}))})).observe(t),t.addEventListener("mousemove",(function(e){t.getAttribute("name"),t.getAttribute("data-document_id");let r=t.dataset.mirror_id,n=document.getElementById(r);n&&n.scrollTo(t.scrollLeft,t.scrollTop)})),t.addEventListener("focusout",(function(e){t.getAttribute("name"),t.getAttribute("data-document_id");let r=t.dataset.mirror_id,n=document.getElementById(r);n&&n.scrollTo(t.scrollLeft,t.scrollTop)})),t.addEventListener("keydown",(function(e){t.getAttribute("name");let r=t.dataset.mirror_id,n=document.getElementById(r);n&&(n.scrollTo(t.scrollLeft,t.scrollTop),g(t))})),t.addEventListener("keyup",(function(e){t.getAttribute("name");let r=t.dataset.mirror_id,n=document.getElementById(r);n&&n.scrollTo(t.scrollLeft,t.scrollTop)}))}}o.default.listen("readDocument",(function(t){let e=document.querySelector('.cursor-flag[data-document_id="'+t.document_id+'"]');e&&(e.innerHTML=t.result[e.getAttribute("name")])})),Element.prototype.remove=function(){this.parentElement&&this.parentElement.removeChild(this)};window.addEventListener("resize",(function(t){document.querySelectorAll("[data-mirror_id]").forEach((function(t,e,r){g(t)}))}),!0),document.addEventListener("scroll",(function(t){document.querySelectorAll("[data-mirror_id]").forEach((function(t,e,r){g(t)}))}),!0),function(t){t.forEach((function(t,e,r){b(t)}))}(s),e.default.init({name:"CoCreateCursor",observe:["addedNodes"],attributesFilter:["data-collection","data-document_id","name","data-realtime"],callback:function(t){let e=t.target;e.hasAttribute("data-collection")&&e.hasAttribute("data-document_id")&&e.hasAttribute("name")&&"true"==e.getAttribute("data-realtime")&&function(t){let e=t||window;e.querySelectorAll&&e.querySelectorAll("[data-realtime=true]").forEach((t=>{b(t)}))}(t.target)}});var y={draw_cursor:h,refresh_mirror:g,recalculate_local_cursors:function(t,e){d.print("count "+e,c);let r=t.hasAttribute("contenteditable")?parseInt(t.getAttribute("selection_start")):t.selectionStart,n=(t.getAttribute("name"),t.getAttribute("data-document_id"),t.getAttribute("data-collection"),t.dataset.mirror_id),o=document.getElementById(n),a=o?o.querySelectorAll(".cursor-container"):null;if(a){let n=[];a.forEach((function(o,a,i){let s=parseInt(o.getAttribute("data-start")),l=o.getAttribute("data-user_name");if(d.print(["my_start local",r,"start cursor "+l+" = ",s],c),s>r&&-1==n.indexOf(l)){d.print("Es mayor",c);let r=parseInt(o.getAttribute("data-end")),a=s+e,i=r+e;d.print(["pos_start",a,"pos_end",i],c);let u=o.querySelector(".cursor-flag").dataset,f=u.socket_id,m={element:t,startPosition:a,endPositon:i,clientId:f,user:{color:u.user_color,name:u.user_name}};d.print(["sent Draw Cursor ",m],c),h(m),n.push(l)}}))}}};t.default=y})(),n=n.default})()}));